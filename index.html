<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#f0f2f5" id="themeMeta">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <link rel="apple-touch-icon" href="icon-192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="HabitTracker">

    <title>Habit Tracker</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app-container">
        <header>
            <div class="header-top">
                <div>
                    <p id="greeting" class="greeting-style"></p>
                    <h1 id="pageTitle">Tages-Ziele</h1>
                </div>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div id="streakDisplay" title="Deine Erfolgsserie">ğŸ”¥ <span id="streakCount">0</span></div>
                    <button id="notificationBtn" onclick="requestNotificationPermission()">ğŸ””</button>
                    <button id="darkModeToggle" onclick="toggleDarkMode()">ğŸŒ™</button>
                    <button id="settingsBtn" onclick="openSettings()">âš™ï¸</button>
                </div>
            </div>
            
            <div id="quoteContainer" class="quote-style">Lade Motivation...</div>

            <div class="progress-container">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            <p id="progressText">0% geschafft</p>
        </header>

        <section id="todoPage" class="page">
            <div class="input-section">
                <button onclick="openAddModal()" class="add-btn-large">â• Neues Ziel erstellen</button>
            </div>
            
            <div class="day-selector" id="viewDaySelector">
                <button class="day-btn active" data-day="today" onclick="setViewDay('today')">Heute</button>
                <button class="day-btn" data-day="1" onclick="setViewDay('1')">Mo</button>
                <button class="day-btn" data-day="2" onclick="setViewDay('2')">Di</button>
                <button class="day-btn" data-day="3" onclick="setViewDay('3')">Mi</button>
                <button class="day-btn" data-day="4" onclick="setViewDay('4')">Do</button>
                <button class="day-btn" data-day="5" onclick="setViewDay('5')">Fr</button>
                <button class="day-btn" data-day="6" onclick="setViewDay('6')">Sa</button>
                <button class="day-btn" data-day="0" onclick="setViewDay('0')">So</button>
            </div>

            <ul id="habitList"></ul>
            <button id="finishDayBtn" class="finish-day-btn" onclick="finishDay()">Tag jetzt manuell beenden</button>
        </section>

        <section id="calendarPage" class="page hidden">
            <h2 style="margin-top: 10px;">Dein Trend</h2>
            <div style="position: relative; height: 200px; width: 100%; margin-bottom: 20px;">
                <canvas id="trendChart"></canvas> 
            </div>

            <div class="stats-container">
                <div class="stat-card">
                    <span class="stat-label">Wochen-Schnitt</span>
                    <span id="statAverage" class="stat-value">0%</span>
                </div>
                <div class="stat-card">
                    <span class="stat-label">Bester Tag</span>
                    <span id="statBest" class="stat-value">0%</span>
                </div>
            </div>
            
            <h2 style="margin-top: 10px;">Vergangene Tage</h2>
            <div id="historyList"></div>
        </section>

        <section id="rankPage" class="page hidden">
            <div class="rank-card">
                <div class="rank-header-large">
                    <span id="rankIconLarge" class="rank-icon-large"></span>
                    <h2 id="rankNameLarge" style="margin: 10px 0;">Lade Rang...</h2>
                    <p id="rankInfoLarge" style="opacity: 0.7;">0 / 0 XP</p>
                </div>
                <div class="rank-progress-wrapper">
                    <div class="rank-progress-bar-bg">
                        <div id="rankProgressBarLarge" class="rank-progress-bar-fill"></div>
                    </div>
                </div>
                <button class="btn-primary" onclick="shareText()" style="margin-top: 20px; width: 100%;">ğŸ“¤ Rang teilen</button>
            </div>

            <h3 style="margin-top: 30px; margin-bottom: 15px;">Dein Aufstieg</h3>
            <div id="rankTimeline" class="rank-timeline">
            </div>
        </section>

        <div id="detailModal" class="modal hidden">
            <div class="modal-content">
                <span class="close" onclick="closeModal()">&times;</span>
                <h2 id="modalDate">Datum</h2>
                    <div class="chart-container">
                        <canvas id="detailChart"></canvas> 
                    </div>
                <p id="modalStatsText"></p>
            </div>
        </div>

        <div id="confirmModal" class="modal hidden">
            <div class="modal-content confirm-box">
                <div class="confirm-icon">ğŸ†</div>
                <h2>Tag abschlieÃŸen</h2>
                
                <p>Wie war das GefÃ¼hl heute?</p>
                <div class="rating-selector">
                    <button id="diff1" class="rate-btn" onclick="setDifficulty(1)">ğŸ˜Š</button>
                    <button id="diff2" class="rate-btn active" onclick="setDifficulty(2)">ğŸ˜</button>
                    <button id="diff3" class="rate-btn" onclick="setDifficulty(3)">ğŸ˜«</button>
                </div>

                <textarea id="dayNote" placeholder="Notiz zum Tag... (Optional)"></textarea>
                
                <div class="confirm-buttons">
                    <button class="btn-secondary" onclick="closeConfirmModal()">Abbrechen</button>
                    
                    <button class="btn-primary" onclick="executeFinishDay()">Speichern & Beenden</button>
                </div>
            </div>
        </div>

        <div id="addHabitModal" class="modal hidden">
            <div class="modal-content">
                <span class="close" onclick="closeAddModal()">&times;</span>
                <h2>Neues Ziel</h2>
                
                <input type="text" id="modalHabitInput" placeholder="Was mÃ¶chtest du tun?" style="width:100%; margin-bottom:15px;">
                
                <select id="modalCategoryInput" style="width:100%; margin-bottom:15px;">
                    <option value="sport">ğŸƒâ€â™‚ï¸ Sport</option>
                    <option value="lernen">ğŸ“š Lernen</option>
                    <option value="gesundheit">ğŸ Gesund</option>
                    <option value="alltag">âš™ï¸ Alltag</option>
                </select>

                <label style="font-size:0.9rem; opacity:0.8; display:block; margin-bottom:5px;">Timer (Optional, in Minuten):</label>
                <input type="number" id="modalDurationInput" placeholder="z.B. 30 fÃ¼r 30 Min" style="width:100%; margin-bottom:20px;">

                <label style="font-size:0.9rem; opacity:0.8; display:block; margin-bottom:5px;">An welchen Tagen?</label>
                <div class="day-selector" id="modalDaySelector" style="margin-bottom: 20px;">
                    <button class="day-btn active" data-day="all" onclick="toggleModalDay('all')">TÃ¤glich</button>
                    <button class="day-btn" data-day="1" onclick="toggleModalDay('1')">Mo</button>
                    <button class="day-btn" data-day="2" onclick="toggleModalDay('2')">Di</button>
                    <button class="day-btn" data-day="3" onclick="toggleModalDay('3')">Mi</button>
                    <button class="day-btn" data-day="4" onclick="toggleModalDay('4')">Do</button>
                    <button class="day-btn" data-day="5" onclick="toggleModalDay('5')">Fr</button>
                    <button class="day-btn" data-day="6" onclick="toggleModalDay('6')">Sa</button>
                    <button class="day-btn" data-day="0" onclick="toggleModalDay('0')">So</button>
                </div>

                <button class="btn-primary" onclick="addHabitFromModal()" style="width:100%;">HinzufÃ¼gen</button>
            </div>
        </div>

        <div id="settingsModal" class="modal hidden">
            <div class="modal-content">
                <span class="close" onclick="closeSettings()">&times;</span>
                <h2>Einstellungen</h2>
                <p>Sichere deine Daten oder lade ein Backup hoch.</p>
                
                <div class="settings-buttons" style="display:flex; flex-direction:column; gap:10px; margin-top:20px;">
                    <button class="btn-primary" onclick="exportData()">ğŸ’¾ Backup herunterladen</button>
                    <button class="btn-secondary" onclick="document.getElementById('importFile').click()">ğŸ“‚ Backup laden</button>
                    <input type="file" id="importFile" style="display:none" onchange="importData(this)">
                </div>
            </div>
        </div>

        <div id="undoToast" class="undo-toast hidden">
            <span>GelÃ¶scht! ğŸ—‘ï¸</span>
            <button onclick="undoDelete()">RÃ¼ckgÃ¤ngig</button>
        </div>

        <div id="shareModal" class="modal hidden">
            <div class="modal-content">
                <span class="close" onclick="closeShareModal()">&times;</span>
                <h2>Erfolg teilen</h2>
                <p>Zeig anderen deinen Fortschritt!</p>
                <div class="settings-buttons" style="display:flex; flex-direction:column; gap:10px; margin-top:20px;">
                    <button class="btn-primary" onclick="shareText()">ğŸ“ Als Text teilen</button>
                    <button class="btn-secondary" onclick="shareChart()">ğŸ“Š Diagramm teilen</button>
                </div>
            </div>
        </div>

        <div id="customAlertModal" class="modal hidden">
            <div class="modal-content" style="text-align: center;">
                <h3 id="customAlertTitle" style="margin-top:0;">Hinweis</h3>
                <p id="customAlertMessage" style="margin: 15px 0; opacity: 0.9;"></p>
                <button class="btn-primary" onclick="closeCustomAlert()" style="width:100%;">Okay</button>
            </div>
        </div>

        <div id="customPromptModal" class="modal hidden">
            <div class="modal-content">
                <h3 id="customPromptTitle" style="margin-top:0;">Eingabe</h3>
                <input type="text" id="customPromptInput" style="width:100%; margin: 15px 0;" onkeydown="if(event.key==='Enter') confirmCustomPrompt()">
                <div class="confirm-buttons">
                    <button class="btn-secondary" onclick="closeCustomPrompt()">Abbrechen</button>
                    <button class="btn-primary" onclick="confirmCustomPrompt()">Speichern</button>
                </div>
            </div>
        </div>

        <nav class="navbar">
            <button onclick="showPage('todo')" id="navTodo" class="active">ğŸ“ Liste</button>
            <button onclick="showPage('calendar')" id="navCalendar">ğŸ“Š Erfolg</button>
            <button onclick="showPage('rank')" id="navRank">ğŸ† RÃ¤nge</button>
        </nav>
    </div>
    <script src="script.js?v=22"></script>
</body>
</html>